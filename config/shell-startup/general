# shellcheck shell=bash

PROMPT_DIRTRIM=2

#-----------------------------------------------------------------------------
alias wget="wget --hsts-file="$XDG_CACHE_HOME/wget-hsts""

#-----------------------------------------------------------------------------
# http://www.commandlinefu.com/commands/view/7156/monitor-a-file-with-tail-with-timestamps-added
tailfile() { tail -f "$1" | xargs -IX printf "$(date -u)\\t%s\\n" X; }

# shellcheck disable=SC2164
md() { mkdir -p "$@" && cd "$@" || return; }

#-----------------------------------------------------------------------------
shopt -s autocd cdspell direxpand dirspell globstar cdable_vars checkhash \
  checkwinsize dotglob extglob nocaseglob 2> /dev/null

umask 022

#-----------------------------------------------------------------------------
# System

alias c='clear'
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias df='df -h'
alias h='history'
#alias rd=rmdir
#alias v='vim'
#alias f='find'

#-----------------------------------------------------------------------------
alias dumppath='echo -e ${PATH//:/\\n}'
alias dumpldpath='echo -e ${LD_LIBRARY_PATH//:/\\n}'
alias dotfiles='cd $DOTFILES'

#-----------------------------------------------------------------------------
# CVS settings
export CVS_RSH='ssh'

#-----------------------------------------------------------------------------
# https://wiki.archlinux.org/index.php/Core_Utilities#ls
eval $(dircolors -b)

alias l='ls -Al --color=auto'
alias sl=ls

#-----------------------------------------------------------------------------
alias diffdir='diff -qr'

if command -v colordiff &> /dev/null; then
  alias diff='colordiff'
  alias diffdir='colordiff -qr'
fi

#-----------------------------------------------------------------------------
# https://wiki.archlinux.org/index.php/Core_Utilities#grep
export GREP_COLOR="1;33"
alias grep='grep --color=auto'
alias g='grep --color=auto'

#-----------------------------------------------------------------------------
# I got this from a co-worker many moons ago. Unfortunately, I don't remember
# who. Basically, if a tree program is not installed, fake it with this.

! command -v tree &> /dev/null \
  && alias tree="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"

#-----------------------------------------------------------------------------
# https://unix.stackexchange.com/a/584733/9032

# Revalidate for another 15 minutes
# Echo expanded command
# Run expanded command

function sudo() {
  command sudo -v

  if [[ $(type -t "$1") == "alias" ]]; then
    set -- bash -ic "$(alias "$1"); $(printf "%q " "$@")"
  fi

  echo "Executing: sudo $*"

  # and do it
  command sudo "$@"
}

#-----------------------------------------------------------------------------
mkdir -p "$XDG_CACHE_HOME/bash"
HISTFILE="$XDG_CACHE_HOME/bash/history"

HISTCONTROL="erasedups:ignoreboth"
HISTFILESIZE=100000
HISTIGNORE="&:[ ]*:exit:ls:bg:fg:history:clear"
HISTSIZE=500000
HISTTIMEFORMAT='%F %T '

shopt -s cmdhist histappend histreedit histverify

alias h='history'

#-----------------------------------------------------------------------------
command -v chromium-browser &> /dev/null && export BROWSER='chromium-browser'
export DOCKER_CONFIG="${XDG_CONFIG_HOME}/docker"

#-----------------------------------------------------------------------------

# This overrides local ansible.cfg
#export ANSIBLE_CONFIG="${XDG_CONFIG_HOME}/ansible.cfg"

#-----------------------------------------------------------------------------
command -v plandex &> /dev/null \
  && source "$XDG_CONFIG_HOME/completions/plandex"

#-----------------------------------------------------------------------------
# Mimic Zsh run-help ability
# Press alt+h to get help for word on cursor
# https://wiki.archlinux.org/title/Bash#Mimic_Zsh_run-help_ability
# See inputrc for macros
#run-help() { help "$READLINE_LINE" 2>/dev/null || man "$READLINE_LINE"; }

#-----------------------------------------------------------------------------
# binenv

if command -v binenv &> /dev/null; then
  BINENV_BINDIR="/home/harleypig/.local/bin"
  BINENV_CACHEDIR="/home/harleypig/.cache/binenv"
  BINENV_CONFDIR="/home/harleypig/projects/dotfiles/config/binenv"

  source <(binenv completion bash)
fi

#-----------------------------------------------------------------------------
# Vault

vaultpath="$(command -v vault 2> /dev/null)"

if [[ -n vaultpath ]]; then
  complete -C "$vaultpath" vault
fi

unset vaultpath

#-----------------------------------------------------------------------------
# aider

# AIDER_4: Description for AIDER_4
# AIDER_4O: Description for AIDER_4O
# AIDER_4_TURBO_VISION: Description for AIDER_4_TURBO_VISION
# AIDER_AIDERIGNORE: Description for AIDER_AIDERIGNORE
# AIDER_APPLY: Description for AIDER_APPLY
# AIDER_ASSISTANT_OUTPUT_COLOR: Description for AIDER_ASSISTANT_OUTPUT_COLOR
# AIDER_AUTO_COMMITS: Description for AIDER_AUTO_COMMITS
# AIDER_CHAT_HISTORY_FILE: Description for AIDER_CHAT_HISTORY_FILE
# AIDER_CHECK_UPDATE: Description for AIDER_CHECK_UPDATE
# AIDER_CODE_THEME: Description for AIDER_CODE_THEME
# AIDER_COMMIT: Description for AIDER_COMMIT
# AIDER_DARK_MODE: Description for AIDER_DARK_MODE
# AIDER_DIRTY_COMMITS: Description for AIDER_DIRTY_COMMITS
# AIDER_DRY_RUN: Description for AIDER_DRY_RUN
# AIDER_EDIT_FORMAT: Description for AIDER_EDIT_FORMAT
# AIDER_ENCODING: Description for AIDER_ENCODING
# AIDER_ENV_FILE: Description for AIDER_ENV_FILE
# AIDER_GIT: Description for AIDER_GIT
# AIDER_GITIGNORE: Description for AIDER_GITIGNORE
# AIDER_GUI: Description for AIDER_GUI
# AIDER_INPUT_HISTORY_FILE: Description for AIDER_INPUT_HISTORY_FILE
# AIDER_LIGHT_MODE: Description for AIDER_LIGHT_MODE
# AIDER_MAP_TOKENS: Description for AIDER_MAP_TOKENS
# AIDER_MAX_CHAT_HISTORY_TOKENS: Description for AIDER_MAX_CHAT_HISTORY_TOKENS
# AIDER_MESSAGE: Description for AIDER_MESSAGE
# AIDER_MESSAGE_FILE: Description for AIDER_MESSAGE_FILE
# AIDER_MODEL: Description for AIDER_MODEL
# AIDER_MODELS: Description for AIDER_MODELS
# AIDER_OPUS: Description for AIDER_OPUS
# AIDER_PRETTY: Description for AIDER_PRETTY
# AIDER_RESTORE_CHAT_HISTORY: Description for AIDER_RESTORE_CHAT_HISTORY
# AIDER_SHOW_DIFFS: Description for AIDER_SHOW_DIFFS
# AIDER_SHOW_MODEL_WARNINGS: Description for AIDER_SHOW_MODEL_WARNINGS
# AIDER_SHOW_PROMPTS: Description for AIDER_SHOW_PROMPTS
# AIDER_SHOW_REPO_MAP: Description for AIDER_SHOW_REPO_MAP
# AIDER_SKIP_CHECK_UPDATE: Description for AIDER_SKIP_CHECK_UPDATE
# AIDER_SONNET: Description for AIDER_SONNET
# AIDER_STREAM: Description for AIDER_STREAM
# AIDER_TOOL_ERROR_COLOR: Description for AIDER_TOOL_ERROR_COLOR
# AIDER_TOOL_OUTPUT_COLOR: Description for AIDER_TOOL_OUTPUT_COLOR
# AIDER_USER_INPUT_COLOR: Description for AIDER_USER_INPUT_COLOR
# AIDER_VERBOSE: Description for AIDER_VERBOSE
# AIDER_VOICE_LANGUAGE: Description for AIDER_VOICE_LANGUAGE
# AIDER_WEAK_MODEL: Description for AIDER_WEAK_MODEL
# AIDER_YES: Description for AIDER_YES
# ANTHROPIC_API_KEY: Description for ANTHROPIC_API_KEY
# OPENAI_API_BASE: Description for OPENAI_API_BASE
# OPENAI_API_DEPLOYMENT_ID: Description for OPENAI_API_DEPLOYMENT_ID
# OPENAI_API_KEY: Description for OPENAI_API_KEY
# OPENAI_API_TYPE: Description for OPENAI_API_TYPE
# OPENAI_API_VERSION: Description for OPENAI_API_VERSION
# OPENAI_ORGANIZATION_ID: Description for OPENAI_ORGANIZATION_ID
