---
# Ensure required variables are defined
- name: Verify required autostart variables are defined
  fail:
    msg: "Required variable '{{ item }}' is not defined for autostart configuration."
  when: item is not defined
  with_items:
    - autostart_app_exec
    - autostart_app_name
    - autostart_app_type

- name: Define required autostart variables

- name: Create GNOME autostart directory if it doesn't exist
  file:
    path: "{{ ansible_env.HOME }}/.config/autostart"
    state: directory
    mode: '0755'

-  template:
    src: autostart_app.desktop.j2
    dest: "{{ ansible_env.HOME }}/.config/autostart/{{ autostart_app_name }}.desktop"
    mode: '0644'

# Ensure the script is executable
- name: Make the Tilix move script executable
  file:
    path: "{{ ansible_env.HOME }}/.local/bin/move_tilix"
    mode: '0755'
  vars:
    autostart_app_name: "{{ app_name | default('myapp') }}"
    autostart_app_exec: "{{ app_exec | default('/usr/bin/myapp') }}"
    autostart_app_comment: "{{ app_comment | default('Autostart entry for myapp') }}"
    autostart_app_terminal: "{{ app_terminal | default(false) }}"
    autostart_app_hidden: "{{ app_hidden | default(false) }}"
