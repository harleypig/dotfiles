---
- name: Load profile if the file exists and tilix_profile_filename is set
  shell: dconf load /com/gexperts/Tilix/ < {{ gnome_settings_tilix_profile_filename }}
  register: dconf_load_result
  changed_when: "'Loading values from' in dconf_load_result.stdout"

- name: Include autostart creation tasks if profile is loaded successfully
  include_tasks: create_autostart.yml
  vars:
    autostart_app_type: Application
    autostart_app_name: Tilix
    autostart_app_settings:
      Exec: tilix
      Comment: Tilix terminal emulator
      X-GNOME-Autostart-enabled: true
      X-GNOME-Autostart-Delay: 1
  when: dconf_load_result is changed

# Add Tilix to the favorites menu bar if it's not already there
- name: Add Tilix to the favorites menu bar
  block:
    - name: Get current list of favorite apps
      command: gsettings get org.gnome.shell favorite-apps
      register: current_favorites

    - name: Add Tilix to the list of favorite apps
      command: gsettings set org.gnome.shell favorite-apps "{{ current_favorites.stdout | regex_replace(']', ', ') }}'tilix.desktop']"
      when: "'tilix.desktop' not in current_favorites.stdout"
  become: yes
  become_user: "{{ ansible_env.SUDO_USER | default(ansible_env.USER) }}"
