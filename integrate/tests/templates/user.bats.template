#!/usr/bin/env bats

# !!! DO NOT EDIT THIS FILE !!!

# Changes to this file will be erased when the build-user-tests script is run
# again.

# If you have a change that applies universally then change the template and
# re-run the setup script. Otherwise, create a new test file with a different
# name.

# !!! DO NOT EDIT THIS FILE !!!

load "$BATS_TEST/global.bash"

TESTUSER='^TESTUSER^'

#-----------------------------------------------------------------------------
[[ -z $PRJ_ENVIRONMENT ]] && {
  echo 'Unknown environment (PRJ_ENVIRONMENT not set), not running tests.'
  exit 1
}

known_env_rx='dev|test|stg|prod'

[[ $PRJ_ENVIRONMENT =~ $known_env_rx ]] || {
  echo "Unknown environment ($PRJ_ENVIRONMENT does not match $known_env_rx), not running tests."
  exit 1
}

[[ -z $PRJ_NAME ]] && {
  echo 'Unknown environment (PRJ_NAME not set), not running tests.'
  exit 1
}

[[ $PRJ_NAME == "$TESTUSER" ]] || {
  echo "Not in $TESTUSER account, not running tests."
  exit 1
}

#-----------------------------------------------------------------------------
@test 'expected groups' {
  declare -A expected_groups

  expected_groups=$(echo $(printf '%s\n' ^EXPECTED_GROUPS^ | sort -u))

  run echo $(printf '%s\n' $(groups) | sort -u)
  assert_output "$expected_groups"
}

^CONTROLM^
^PASSWORD_NONE^
^PASSWORD_REQUIRED^
^PASSWORD_EOF^
^PASSWORD_TIMEOUT^
