#!/bin/bash

# Git Prompt Loader
# This script checks if git prompt functions are already loaded,
# and if not, finds and sources the system's git-prompt file.

# Check if __git_ps1 function is already available
if declare -f __git_ps1 >/dev/null 2>&1; then
  # Git prompt functions are already loaded, nothing to do
  return 0
fi

# Search for git-prompt files in common locations
declare -a git_prompt_locations=(
  '/usr/share/git-core/contrib/completion/git-prompt.sh'
  '/usr/share/git/completion/git-prompt.sh'
  '/usr/lib/git-core/git-sh-prompt'
  '/usr/local/share/git-core/contrib/completion/git-prompt.sh'
  '/opt/homebrew/share/git-core/contrib/completion/git-prompt.sh'  # macOS Homebrew
)

# Try to find and source the git-prompt file
for location in "${git_prompt_locations[@]}"; do
  if [[ -r "$location" ]]; then
    # shellcheck disable=SC1090
    source "$location"
    return 0
  fi
done

# If no system git-prompt found, warn and exit
echo "Warning: Could not find git-prompt.sh in system locations" >&2
echo "Git prompt functionality will not be available" >&2
return 1