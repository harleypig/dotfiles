#!/bin/bash

command -v vault &> /dev/null || {
    echo "Error: vault is required to run this script"
    exit 1
}

declare user="${1:-$USER}"
declare -x VAULT_TOKEN

VAULT_TOKEN="$(vault login -token-only -method=ldap username="$user")" || {
    declare rc=$?
    echo "$VAULT_TOKEN"
    unset VAULT_TOKEN
    return $rc
}