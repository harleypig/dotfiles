#!/bin/bash

# This script looks for '.git' directories under $HOME/projects
# and stores the directory name and path to the repo relative to $HOME/projects
# in an associative array.

azure_url_pattern="dev.azure.com"
projects_path="$HOME/projects"

declare -A repos

while IFS= read -r -d '' gitdir; do
  grep -q "$azure_url_pattern" "$gitdir/config" || continue

  repo_path="${gitdir#$HOME/projects/}"
  repo_path="${repo_path%/.git}"
  repo_name="${repo_path##*/}"

  if [[ -n "${repos[$repo_name]}" ]]; then
    echo "$repo_name is duplicated (${repos[$repo_name]}) not adding $repo_path" >&2
    continue
  fi

  repos[$repo_name]="$repo_path"
done < <(find "$HOME/projects" -type d -name '.git' -print0)

# You can access the associative array 'repos' as needed from here.
